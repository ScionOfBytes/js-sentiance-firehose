var SentianceFirehose=function(){var e,n,t=1e3,i=function(e,n,t,i){setTimeout(a(e,n,t,i))},o=function(){n&&n.connected&&n.disconnect()},r=function(n){e=n},a=function(n,t,i,o){if(!n)throw new Error("No app id configured");if(!t)throw new Error("No stream definition id configured");if(!i)throw new Error("No bearer token configured");if(!e)throw new Error("No data handler configured");c(n,t,i,o)},s=function(e,n,i,o){t=2*t,setTimeout(function(){a(e,n,i,o)},t)},c=function(e,n,t,i){var o=new XMLHttpRequest,r={query:"        mutation($app_id: String!, $stream_definition_id: String!, $user_ids: [String]) {          createSubscription(app_id:$app_id, stream_definition_id: $stream_definition_id, user_ids: $user_ids) {            id            token          }        }      ",variables:{app_id:e,stream_definition_id:n,user_ids:i||null}};o.open("POST","https://api.sentiance.com/v2/gql",!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization","Bearer "+t),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var r=JSON.parse(o.responseText);if(r.data&&r.data.createSubscription){var a=r.data.createSubscription.id,c=r.data.createSubscription.token;d(a,c)}else s(e,n,t,i)}else s(e,n,t,i)},o.send(JSON.stringify(r))},d=function(t,i){n=io("https://firehose.sentiance.com/"),n.on("connect",function(){u(n,t,i)}),n.on("data",function(n){var t=JSON.parse(n);e(t.data,t.errors,t.metadata)}),n.on("disconnect",function(){}),n.on("error",function(e){})},u=function(e,n,t){var i={id:n,token:t};e.emit("subscribe-v1",i)};return{connect:i,disconnect:o,onData:r}}();module.exports=SentianceFirehose;